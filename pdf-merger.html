<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>PDF Merger by Istinub Azad</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
/* --- Base Layout --- */
body{
  font-family:"Inter",sans-serif;
  background:
    linear-gradient(rgba(255,255,255,.9),rgba(255,255,255,.9)),
    url('https://images.unsplash.com/photo-1519389950473-47ba0277781c?auto=format&fit=crop&w=1600&q=80');
  background-size:cover;background-position:center;background-attachment:fixed;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  min-height:100vh;margin:0;padding:24px 12px;
}
header{text-align:center;margin-bottom:16px;}
header h1{margin:0;font-size:28px;color:#222;text-shadow:0 1px 2px rgba(0,0,0,.15);}
header p{margin-top:6px;font-size:15px;color:#555;}
.card{
  background:rgba(255,255,255,.96);
  border-radius:14px;box-shadow:0 8px 25px rgba(0,0,0,.08);
  padding:24px;width:100%;max-width:980px;text-align:center;backdrop-filter:blur(8px);
}

/* --- Upload Zone --- */
.drop-zone{
  position:relative;border:2px dashed #c6c9d1;border-radius:10px;padding:26px;
  color:#555;background:#fafafa;transition:all .25s;cursor:pointer;margin-bottom:18px;
}
.drop-zone:hover,.drop-zone.dragover{border-color:#007bff;background:#eef5ff;}
.drop-zone input{position:absolute;inset:0;width:100%;height:100%;opacity:0;cursor:pointer;}

/* --- Grid of PDF Cards --- */
.grid{display:flex;flex-wrap:wrap;gap:16px;justify-content:center;margin-bottom:18px;}
.file-card{
  width:180px;background:#f9fafb;border-radius:10px;box-shadow:0 3px 6px rgba(0,0,0,.05);
  padding:10px;display:flex;flex-direction:column;align-items:center;cursor:grab;transition:transform .15s;
}
.file-card.dragging{opacity:.55;transform:scale(.97);}
.file-card.drag-over{outline:2px dashed #007bff;}
.file-card canvas{border:1px solid #ddd;border-radius:6px;width:100%;height:210px;object-fit:cover;}
.file-name{margin-top:8px;font-size:13px;color:#333;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;width:100%;}
.actions{display:flex;gap:6px;margin-top:6px;}
.actions button{
  border:none;border-radius:5px;padding:4px 6px;font-size:12px;cursor:pointer;
  background:#e9ecef;color:#333;transition:background .2s;
}
.actions button:hover{background:#d7dbe0;}
.delete-btn{background:#fdecec;color:#d00;}
.delete-btn:hover{background:#fbd6d6;}

/* --- Merge Button --- */
#mergeBtn{
  background:#007bff;color:#fff;border:none;border-radius:6px;padding:10px 20px;
  font-size:16px;cursor:pointer;transition:background .2s,transform .1s;
}
#mergeBtn:hover{background:#0056b3;transform:scale(1.03);}
.status{margin-top:12px;color:#555;font-size:14px;}

footer{text-align:center;margin-top:18px;font-size:13px;color:#555;}
footer a{color:#007bff;font-weight:600;text-decoration:none;}
footer a:hover{text-decoration:underline;}

/* --- Modal: Preview & Edit --- */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;padding:20px;z-index:9999;}
.modal.open{display:flex;}
.modal-content{background:#fff;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.25);
  width:min(1000px,96vw);max-height:92vh;display:flex;flex-direction:column;}
.modal-header{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;border-bottom:1px solid #eee;gap:10px;flex-wrap:wrap;}
.modal-title{font-weight:600;font-size:15px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:48ch;}
.modal-actions{display:flex;gap:8px;flex-wrap:wrap;align-items:center;}
.modal-actions button{background:#eef1f4;border:none;border-radius:6px;padding:6px 10px;cursor:pointer;font-size:13px;}
.modal-actions button:hover{background:#dfe4ea;}
.close-btn{background:#fdecec;color:#d00;}
.close-btn:hover{background:#fbd6d6;}
.canvas-wrap{padding:12px;overflow:auto;display:flex;justify-content:center;align-items:center;background:#f7f8fa;}
#fullCanvas{background:#fff;border:1px solid #e5e7eb;border-radius:8px;max-width:100%;}
.thumb-strip{display:flex;overflow-x:auto;gap:6px;padding:8px 10px;background:#fafafa;border-top:1px solid #eee;}
.thumb-strip canvas{border:1px solid #ccc;border-radius:4px;height:84px;cursor:pointer;transition:transform .2s;}
.thumb-strip canvas:hover{transform:scale(1.08);border-color:#007bff;}
.modal-footer{display:flex;justify-content:space-between;align-items:center;padding:8px 16px;border-top:1px solid #eee;font-size:13px;color:#555;}
@media(max-width:560px){.file-card{width:45%;}}
</style>
</head>
<body>

<header>
  <h1>PDF Merger</h1>
  <p>A simple but handy app for daily use</p>
</header>

<div class="card">
  <div class="drop-zone" id="dropZone">
    <p>üìÇ <strong>Click</strong> or <strong>Drag & Drop</strong> PDFs here</p>
    <input type="file" id="fileInput" multiple accept="application/pdf">
  </div>

  <div class="grid" id="fileGrid"></div>

  <button id="mergeBtn">Merge PDFs (in shown order)</button>
  <div class="status" id="statusMsg"></div>
</div>

<footer>
  Created by <a href="https://istinubazad.github.io/" target="_blank">Istinub Azad</a>
</footer>

<!-- Modal -->
<div class="modal" id="previewModal" aria-hidden="true">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title" id="modalTitle">Preview</div>
      <div class="modal-actions">
        <span id="pageInfo">Page 1 / 1</span>
        <button id="prevPage">‚óÄ</button>
        <button id="nextPage">‚ñ∂</button>
        <button id="zoomOut">‚ûñ</button>
        <button id="zoomIn">‚ûï</button>
        <button id="rotateLeft">‚Ü©Ô∏è</button>
        <button id="rotateRight">‚Ü™Ô∏è</button>
        <button id="resetRot">üîÅ Reset</button>
        <button class="close-btn" id="closeModal">‚úñ</button>
      </div>
    </div>
    <div class="canvas-wrap"><canvas id="fullCanvas"></canvas></div>
    <div class="thumb-strip" id="thumbStrip"></div>
    <div class="modal-footer">
      <div id="hint">Tips: ‚Üê/‚Üí page ‚Ä¢ +/- zoom ‚Ä¢ L/R rotate ‚Ä¢ Esc close</div>
      <div id="fileInfo"></div>
    </div>
  </div>
</div>

<!-- Libraries -->
<script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script>
pdfjsLib.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";
const { PDFDocument, degrees } = PDFLib;
let selectedFiles = [];

const dropZone=document.getElementById("dropZone");
const fileInput=document.getElementById("fileInput");
const fileGrid=document.getElementById("fileGrid");
const statusMsg=document.getElementById("statusMsg");
const mergeBtn=document.getElementById("mergeBtn");

/* Modal elements */
const modal=document.getElementById("previewModal");
const modalTitle=document.getElementById("modalTitle");
const pageInfo=document.getElementById("pageInfo");
const fullCanvas=document.getElementById("fullCanvas");
const ctx=fullCanvas.getContext("2d");
const btnPrev=prevPage,btnNext=nextPage,btnZoomIn=zoomIn,btnZoomOut=zoomOut,btnRotL=rotateLeft,btnRotR=rotateRight,btnReset=resetRot,btnClose=closeModal;
const thumbStrip=document.getElementById("thumbStrip"),fileInfo=document.getElementById("fileInfo");

let currentFileIndex=null,currentPdf=null,currentPageNumber=1,currentScale=1.25,isModalOpen=false;

/* File upload + drag */
fileInput.onchange=e=>{addFiles([...e.target.files]);fileInput.value="";};
dropZone.ondragover=e=>{e.preventDefault();dropZone.classList.add("dragover");};
dropZone.ondragleave=()=>dropZone.classList.remove("dragover");
dropZone.ondrop=e=>{e.preventDefault();dropZone.classList.remove("dragover");addFiles([...e.dataTransfer.files]);};

function addFiles(fs){fs.forEach(f=>{if(f.type==="application/pdf")selectedFiles.push({file:f,pageCount:0,rotations:{}})});renderGrid();}

/* Grid */
async function renderGrid(){
  fileGrid.innerHTML="";
  for(let i=0;i<selectedFiles.length;i++){
    const it=selectedFiles[i];
    const card=document.createElement("div");
    card.className="file-card";
    card.draggable=true;
    card.dataset.index=i;
    const canvas=document.createElement("canvas");
    const name=document.createElement("div");
    name.className="file-name";name.textContent=`${i+1}. ${it.file.name}`;
    const actions=document.createElement("div");
    actions.className="actions";
    actions.innerHTML=`<button onclick="openPreview(${i})">üëÅ Preview</button><button class="delete-btn" onclick="removeFile(${i})">üóë</button>`;
    card.append(canvas,name,actions);
    fileGrid.appendChild(card);
    card.addEventListener("dragstart",dragStart);
    card.addEventListener("dragover",dragOver);
    card.addEventListener("dragleave",dragLeave);
    card.addEventListener("drop",dropCard);
    card.addEventListener("dragend",dragEnd);
    try{
      const ab=await it.file.arrayBuffer();
      const pdf=await pdfjsLib.getDocument({data:ab}).promise;
      if(!it.pageCount)it.pageCount=pdf.numPages;
      const p=await pdf.getPage(1);
      const vp=p.getViewport({scale:.42});
      const ctx2=canvas.getContext("2d");
      canvas.width=vp.width;canvas.height=vp.height;
      await p.render({canvasContext:ctx2,viewport:vp}).promise;
    }catch(e){console.error(e);}
  }
}
window.removeFile=i=>{selectedFiles.splice(i,1);renderGrid();};

/* Drag reorder */
let dragSrc=null;
function dragStart(e){dragSrc=this;this.classList.add("dragging");}
function dragOver(e){e.preventDefault();this.classList.add("drag-over");}
function dragLeave(){this.classList.remove("drag-over");}
function dropCard(e){
  e.stopPropagation();this.classList.remove("drag-over");
  const s=parseInt(dragSrc.dataset.index),t=parseInt(this.dataset.index);
  if(s!==t){const m=selectedFiles.splice(s,1)[0];selectedFiles.splice(t,0,m);renderGrid();}
}
function dragEnd(){this.classList.remove("dragging");}

/* Modal open + render */
window.openPreview=async(i)=>{
  currentFileIndex=i;
  const it=selectedFiles[i];
  modalTitle.textContent=it.file.name;
  currentScale=1.25;currentPageNumber=1;
  const ab=await it.file.arrayBuffer();
  currentPdf=await pdfjsLib.getDocument({data:ab}).promise;
  it.pageCount=currentPdf.numPages;
  isModalOpen=true;modal.classList.add("open");modal.setAttribute("aria-hidden","false");
  await buildThumbs();await renderPage();
};
function closePreview(){
  isModalOpen=false;modal.classList.remove("open");
  modal.setAttribute("aria-hidden","true");
  currentPdf=null;currentFileIndex=null;thumbStrip.innerHTML="";
}
async function renderPage(){
  if(!currentPdf||currentFileIndex===null)return;
  const it=selectedFiles[currentFileIndex];
  const p=await currentPdf.getPage(currentPageNumber);
  const rot=it.rotations[currentPageNumber-1]||0;
  const vp=p.getViewport({scale:currentScale,rotation:rot});
  fullCanvas.width=vp.width;fullCanvas.height=vp.height;
  await p.render({canvasContext:ctx,viewport:vp}).promise;
  pageInfo.textContent=`Page ${currentPageNumber} / ${currentPdf.numPages}`;
  fileInfo.textContent=`Zoom ${(currentScale*100).toFixed(0)}% ¬∑ Rot ${rot}¬∞`;
  [...thumbStrip.children].forEach((c,idx)=>c.style.outline=(idx+1===currentPageNumber)?"2px solid #007bff":"none");
}
async function buildThumbs(){
  thumbStrip.innerHTML="";
  for(let i=1;i<=currentPdf.numPages;i++){
    const c=document.createElement("canvas");
    thumbStrip.appendChild(c);
    const pg=await currentPdf.getPage(i);
    const vp=pg.getViewport({scale:0.16});
    c.width=vp.width;c.height=vp.height;
    pg.render({canvasContext:c.getContext("2d"),viewport:vp});
    c.onclick=async()=>{currentPageNumber=i;await renderPage();};
  }
}

/* Controls */
btnPrev.onclick=async()=>{if(currentPageNumber>1){currentPageNumber--;await renderPage();}};
btnNext.onclick=async()=>{if(currentPageNumber<currentPdf.numPages){currentPageNumber++;await renderPage();}};
btnZoomIn.onclick=async()=>{currentScale=Math.min(currentScale+.25,3);await renderPage();};
btnZoomOut.onclick=async()=>{currentScale=Math.max(currentScale-.25,.5);await renderPage();};
btnRotL.onclick=async()=>{const it=selectedFiles[currentFileIndex];const i=currentPageNumber-1;it.rotations[i]=(it.rotations[i]||0)-90;if(it.rotations[i]<0)it.rotations[i]+=360;await renderPage();};
btnRotR.onclick=async()=>{const it=selectedFiles[currentFileIndex];const i=currentPageNumber-1;it.rotations[i]=(it.rotations[i]||0)+90;if(it.rotations[i]>=360)it.rotations[i]-=360;await renderPage();};
btnReset.onclick=async()=>{selectedFiles[currentFileIndex].rotations={};await renderPage();};

/* Close modal + update thumbnail */
btnClose.onclick=async()=>{
  const idx=currentFileIndex;
  closePreview();
  if(idx!==null&&selectedFiles[idx]){
    const it=selectedFiles[idx];
    const card=fileGrid.querySelector(`.file-card[data-index="${idx}"]`);
    if(card){
      const canvas=card.querySelector("canvas");
      try{
        const ab=await it.file.arrayBuffer();
        const pdf=await pdfjsLib.getDocument({data:ab}).promise;
        const p=await pdf.getPage(1);
        const rot=it.rotations[0]||0;
        const vp=p.getViewport({scale:.42,rotation:rot});
        canvas.width=vp.width;canvas.height=vp.height;
        await p.render({canvasContext:canvas.getContext("2d"),viewport:vp}).promise;
      }catch(e){console.error("Thumb update failed:",e);}
    }
  }
};

/* Merge PDFs */
mergeBtn.onclick=async()=>{
  if(selectedFiles.length<2){statusMsg.textContent="Please select at least two PDFs.";return;}
  statusMsg.textContent="Merging in shown order...";
  try{
    const merged=await PDFDocument.create();
    for(const it of selectedFiles){
      const bytes=await it.file.arrayBuffer();
      const src=await PDFDocument.load(bytes);
      const pages=await merged.copyPages(src,src.getPageIndices());
      pages.forEach((p,i)=>{const r=it.rotations[i]||0;if(r)p.setRotation(degrees(r));merged.addPage(p);});
    }
    const mergedBytes=await merged.save();
    const blob=new Blob([mergedBytes],{type:"application/pdf"});
    const a=document.createElement("a");
    a.href=URL.createObjectURL(blob);
    a.download="merged.pdf";a.click();
    statusMsg.textContent="‚úÖ Merged successfully!";
  }catch(e){console.error(e);statusMsg.textContent="‚ùå Merge failed.";}
};
</script>
</body>
</html>
